(function(){function h(a){console.log;a.players.forEach(function(d){e(d)});a.all_specs.forEach(function(d){f(d)});g(a);if(!1===a.inlobby){var b=prompt("\u0412\u0430\u0448 \u043d\u0438\u043a?");c.send(JSON.stringify({new_player:b,root:a.root,session:a.session}))}else c.send(JSON.stringify({session:a.session}));!1===a.start&&(b=document.createElement("div"),b.className="joinbtn",b.textContent="\u0412\u043e\u0439\u0442\u0438",b.addEventListener("click",function(){c.send(JSON.stringify({change:!0}))}),
document.querySelector(".buttons").appendChild(b));a.root&&!1===a.start&&(a=document.createElement("div"),a.className="button start",a.textContent="start",a.addEventListener("click",function(){$(".start").remove();c.send(JSON.stringify({"function":"start"}))}),document.querySelector(".buttons").appendChild(a))}function e(a){var b=document.createElement("div");b.className=a.id;b.textContent=a.name;!0===a.play?(b.className+=" player",document.querySelector(".players").appendChild(b)):document.querySelector(".spectors").appendChild(b)}
function g(a){var b={};for(spec in a.self_specs)console.log(spec),b.$jscomp$loop$prop$new_spec$1=document.createElement("div"),b.$jscomp$loop$prop$new_spec$1.className="self "+spec,b.$jscomp$loop$prop$new_spec$1.textContent=a.self_specs[spec],b.$jscomp$loop$prop$new_spec$1.addEventListener("click",function(d){return function(){c.send(JSON.stringify({open:d.$jscomp$loop$prop$new_spec$1.className.split(" ")[1]}))}}(b)),document.querySelector(".specific").appendChild(b.$jscomp$loop$prop$new_spec$1),
b={$jscomp$loop$prop$new_spec$1:b.$jscomp$loop$prop$new_spec$1}}function f(a){var b=document.createElement("div");b.className="spec";b.textContent=a.spec;document.querySelector("."+a.player).appendChild(b)}var k=window.location.href.split("/")[window.location.href.split("/").length-2],c=new WebSocket("ws://"+window.location.host+"/ws/bunker/"+k+"/"),l=setInterval(function(){1===c.readyState&&(console.log("send"),$.ajax({url:"getplayers",success:function(a){h(a)}}),clearInterval(l))});c.onmessage=
function(a){a=JSON.parse(a.data);"add_player"===a["function"]?e(a):"change"===a["function"]?(document.querySelector("."+a.id).remove(),e(a)):"delete"===a["function"]?$("."+a.id).remove():"get_spec"===a["function"]?($(".joinbtn").remove(),g(a)):"open"===a["function"]&&f(a)};document.querySelector(".spectors").addEventListener("click",function(){c.send(JSON.stringify({change:!1}))})})();